<!DOCTYPE html>
<html lang="kr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Docker Compose - Seorenn Static Pages</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Heeseung Seo (Seorenn)">
<meta name="description" content="도커 명령을 스펙 파일로 자동화할 수 있는 도구인 Docker Compose(도커 컴포즈)에 대한 간단한 소개 및 예제를 정리합니다.">
<meta property="og:title" content="Docker Compose" />
<meta property="og:description" content="도커 명령을 스펙 파일로 자동화할 수 있는 도구인 Docker Compose(도커 컴포즈)에 대한 간단한 소개 및 예제를 정리합니다." />
<meta property="og:type" content="website" />
<meta property="og:image" content="https://seorenn.github.io/img/seorenn-logo.png" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Docker Compose" />
<meta name="twitter:description" content="도커 명령을 스펙 파일로 자동화할 수 있는 도구인 Docker Compose(도커 컴포즈)에 대한 간단한 소개 및 예제를 정리합니다." />
<meta name="twitter:image" content="https://seorenn.github.io/img/seorenn-logo.png" />
<meta name="twitter:site" content="@seorenn" />
<meta name="twitter:creator" content="@seorenn" />
<link rel="stylesheet" type="text/css" href="/static/style.css"/>
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico"/>
<link rel="canonical" href="https://seorenn.github.io/docker-compose.html"/>
<link property="og:url" href="https://seorenn.github.io/docker-compose.html"/>
<meta name="google-site-verification" content="YqTFZuthbvGIlDE1dhxiTjZ3m-GfyNs_rsHaOlPKpug" />
<meta name="naver-site-verification" content="ebf6a89968fd9f447c1a77d83e2c4aa9bdbb0345"/>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-44534026-1"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-44534026-1');
</script>
</head>
<body>
<script data-ad-client="ca-pub-1071465863344332" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<div id="content">
<header>
<h1 class="title">Docker Compose</h1>
<h2><a href="/">Seorenn Static Pages</a></h2></header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org414fb4b">Docker Compose</a></li>
<li><a href="#org5aec998">명령어 예제</a></li>
<li><a href="#org0b44c27">예제</a></li>
<li><a href="#orgd79bd86">관련글</a></li>
</ul>
</div>
</nav>

<div id="outline-container-org414fb4b" class="outline-2">
<h2 id="org414fb4b">Docker Compose</h2>
<div class="outline-text-2" id="text-org414fb4b">
<p>
Docker Compose(도커 컴포즈)는 <a href="docker.html">Docker</a> 컨테이너를 띄우는 명령을 스크립트로
명시해서 좀 더 쉽게 컨테이너를 띄우거나 다수의 컨테이너를 한 번에 띄울 수 있도록
도와주는 도구입니다.
</p>

<p>
개인적으로 개발 환경에서 자주 사용합니다. 서버와 비슷한 상황을 로컬에 구현해
두고 도커로 테스트할 때 편합니다.
</p>

<p>
컴포즈 명세 파일은 <code>docker-compose.yml</code> 이라는 파일명을 사용합니다. 물론
마음대로 지어도 상관은 없지만 파일 이름이 다르면 커맨드가 좀 더 길어진다는 단점이 있습니다.
</p>
</div>
</div>
<div id="outline-container-org5aec998" class="outline-2">
<h2 id="org5aec998">명령어 예제</h2>
<div class="outline-text-2" id="text-org5aec998">
<ul class="org-ul">
<li><code>docker-compose up</code> 모든 서비스를 실행합니다. <code>Ctrl-C</code> 키로 종료시킬 수
있습니다.</li>
<li><code>docker-compose up -d</code> 데몬 모드(백그라운드)로 모든 서비스를 실행시킵니다.</li>
<li><code>docker-compose -f some-docker-compose-file.yml up</code>
특정 파일 이름(some-docker-compose-file.yml)의 컴포즈
파일을 이용해 서비스를 올립니다.</li>
<li><code>docker-compose down</code> 모든 중지된 서비스를 내립니다.</li>
<li><code>docker-compose exec service_name command</code> 특정 실행 중인 컨테이너에서 특정
커맨드를 실행시킵니다.</li>
<li><code>docker-compose run service_name command</code> 특정 서비스 컨테이너를 특정 커맨드로
실행시킵니다. 컨테이너가 새로 생성되는 점이 exec 명령어와 다릅니다.</li>
</ul>
</div>
</div>
<div id="outline-container-org0b44c27" class="outline-2">
<h2 id="org0b44c27">예제</h2>
<div class="outline-text-2" id="text-org0b44c27">
<div class="org-src-container">
<pre class="src src-text">version: '3'
services:
  mongo:
    image: mongo
    container_name: mongo
    ports:
      - "27017:27017"
    environment:
      - MONGO_DATA_DIR=/data/db
    volumes:
      - /tmp/mongo:/data/db
  redis:
    image: redis
    container_name: redis
    ports:
      - "6379:6379"
  app:
    build:
      context: .
      dockerfile: ./app-dockerfile
    container_name: app
    depends_on:
      - "redis"
      - "mongo"
    volumes:
      - ./:/tmp/app
      - /tmp/appdata:/tmp/appdata
</pre>
</div>
<p>
이 예제는 3 버전 스펙에 맞는 Docker Compose 파일입니다.
그리고 mongo, redis, app 이라는 3개의 서비스로 구성되어 있습니다.
</p>

<p>
mongo 서비스는 <code>mongo</code> 라는 이미지를 통해 실행되는 컨테이너입니다. 내부 27017 포트는
외부 27017 포트로 연결됩니다. 환경변수로 <code>MONGO_DATE_DIR</code> 을 정의하고 있습니다.
그리고 내 컴퓨터의 <code>/tmp/mongo</code> 디렉토리는 컨테이너 내부에서 <code>/data/db</code> 라는 이름의
디렉토리로 공유됩니다.
</p>

<p>
redis 서비스는 <code>redis</code> 라는 이미지를 통해 실행되는 컨테이너입니다. 이 컨테이너
내부의 6379 포트는 내 컴퓨터의 6379 포트와 연결됩니다.
</p>

<p>
app 이라는 서비스는 별도로 작성된 <code>app-dockerfile</code> 이라는 도커 명세로 빌드하는
이미지로 구동됩니다. 이 컨테이너는 redis와 mongo가 먼저 실행된 후에
실행됩니다. 공유 볼륨으로 현재 디렉토리(즉 프로젝트 디렉토리)는 <code>/tmp/app</code>
디렉토리와 공유되고, 내 컴퓨터의 <code>/tmp/appdata</code> 디렉토리는 컨테이너 내부의
<code>/tmp/appdata</code> 라는 똑같은 이름으로 공유됩니다.
</p>

<p>
이렇게 3개의 서비스를 하나의 Docker Compose 파일을 통해 구동할 수 있습니다.
심지어 많은 명령을 입력할 필요 없이 그저 아래 커맨드 하나면 손쉽게 컨테이너들이
구동됩니다.
</p>
<div class="org-src-container">
<pre class="src src-bash">docker-compose up
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd79bd86" class="outline-2">
<h2 id="orgd79bd86">관련글</h2>
<div class="outline-text-2" id="text-orgd79bd86">
<ul class="org-ul">
<li><a href="docker.html">Docker</a></li>
<li><a href="dockerfile.html">Dockerfile</a></li>
</ul>
</div>
</div>
<div id="footer"><div id="time">2020년 01월 06일 마지막으로 수정됨</div><div id="copyright">Copyright 2019 Heeseung Seo (Seorenn)</div></div></div>
</body>
</html>
